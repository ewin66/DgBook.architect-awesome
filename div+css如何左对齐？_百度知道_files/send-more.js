define("question-new:widget/js/send-more/send-more.es",function(require,exports,module){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _tangram=require("common:widget/js/util/tangram/tangram"),_tangram2=_interopRequireDefault(_tangram),_store=require("common:widget/js/util/store/store"),_store2=_interopRequireDefault(_store),init=function init(){var tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<div class="wgt-send-more">    <div class="wgt-send-more-text">以上回答是否满意？</div>    <div class="wgt-send-more-btn">发给更多人</div></div>'),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0](),$answers=_tangram2.default(".wgt-answers").find(".answer"),answerNum=parseInt(F.context("page").answerNum,10),query=_tangram2.default.url.queryToJson(location.search),pn=parseInt(query.pn,10)||0,rn=parseInt(query.rn,10)||5,pastTime=parseInt(_store2.default.get("send_more_"+F.context("page").qid),10),askCreateTime=parseInt(F.context("page").createTime,10),sendMoreHasClick=void 0;Number(F.context("page").isAdopted)||(pastTime||(_store2.default.set("send_more_"+F.context("page").qid,askCreateTime),pastTime=askCreateTime),pastTime===askCreateTime?pn+rn>=answerNum&&$answers.last().find(".content-wrapper").after(tpl):$answers.each(function(e,t){var a=_tangram2.default(t),r=a.data("createtime");return t===$answers.first()[0]&&pastTime>r?!1:pastTime>r?($answers.eq(e-1).find(".content-wrapper").after(tpl),!1):void 0}),_tangram2.default(".wgt-send-more-btn").on("click",function(e){var t=_tangram2.default(e.currentTarget);sendMoreHasClick||(sendMoreHasClick=!0,_tangram2.default.ajax({type:"post",url:"/msubmit/getbetteranswer",data:{qid:F.context("page").qid},dataType:"json",success:function(e){if(0===e.errno){var a=Math.ceil(5e3*Math.random())+25e3;t.html('已推送给 <span class="text-green">'+a+"</span> 位答题者").addClass("has-send"),_store2.default.set("send_more_"+F.context("page").qid,new Date/1e3)}else sendMoreHasClick=!1},error:function(){sendMoreHasClick=!1}}))}))};exports.default={init:init}});